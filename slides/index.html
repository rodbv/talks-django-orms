<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Django ORM â€” performance</title>
    <link rel="stylesheet" href="node_modules/reveal.js/dist/reveal.css" />
    <link rel="stylesheet" href="node_modules/reveal.js/dist/theme/beige.css" />
    <!-- Light code theme (Python-friendly); override after reveal theme -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
      crossorigin="anonymous"
    />
    <style>
      .reveal p,
      ul {
        font-size: 0.6em;
      }
      .reveal pre {
        background: #f6f8fa;
      }
      .reveal pre code {
        background: none;
        padding: 0.5em;
      }
      .reveal img.img {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }
      .reveal .small {
        font-size: 0.65em;
      }
      .reveal .hljs-ln-numbers {
        opacity: 0.3;
      }
      .reveal .mermaid {
        font-size: 0.55em;
      }
      .reveal .mermaid svg {
        max-width: 100%;
        height: auto;
      }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section
          data-markdown="slides.md"
          data-separator="^\r?\n---\r?\n$"
          data-separator-notes="^Note:"
        ></section>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"
      crossorigin="anonymous"
    ></script>
    <script type="module">
      import Reveal from "./node_modules/reveal.js/dist/reveal.esm.js";
      import Markdown from "./node_modules/reveal.js/plugin/markdown/markdown.esm.js";
      import Highlight from "./node_modules/reveal.js/plugin/highlight/highlight.esm.js";
      import Zoom from "./node_modules/reveal.js/plugin/zoom/zoom.esm.js";

      Reveal.initialize({
        hash: true,
        plugins: [Markdown, Highlight, Zoom],
      }).then(() => {
        const mermaid = window.mermaid;
        mermaid.initialize({
          startOnLoad: false,
          er: { layoutDirection: "LR" },
          flowchart: { useMaxWidth: true },
        });
        function isMermaidBlock(el) {
          const code = el.textContent.trim();
          return (
            el.classList.contains("language-mermaid") ||
            (el.className && el.className.includes("mermaid")) ||
            /^\s*(flowchart|graph|erDiagram|sequenceDiagram|classDiagram)/m.test(
              code,
            )
          );
        }
        function renderMermaidBlocks() {
          document.querySelectorAll(".reveal pre code").forEach((codeEl) => {
            if (!isMermaidBlock(codeEl)) return;
            const pre = codeEl.closest("pre");
            if (!pre || pre.getAttribute("data-mermaid-done")) return;
            const code = codeEl.textContent.trim();
            if (!code) return;
            mermaid
              .render("mermaid-" + Math.random().toString(36).slice(2), code)
              .then(({ svg }) => {
                const wrap = document.createElement("div");
                wrap.className = "mermaid";
                wrap.style.textAlign = "center";
                wrap.setAttribute("data-mermaid-done", "true");
                wrap.innerHTML = svg;
                pre.parentNode.replaceChild(wrap, pre);
              })
              .catch((err) => console.warn("Mermaid render failed:", err));
          });
          document
            .querySelectorAll(".reveal .mermaid:not([data-mermaid-done])")
            .forEach((el) => {
              if (el.querySelector("svg")) return;
              const contentEl =
                el.firstElementChild?.tagName === "PRE"
                  ? el.firstElementChild
                  : el;
              const code = contentEl.textContent.trim();
              if (!code) return;
              mermaid
                .render("mermaid-" + Math.random().toString(36).slice(2), code)
                .then(({ svg }) => {
                  el.innerHTML = svg;
                  el.setAttribute("data-mermaid-done", "true");
                })
                .catch((err) => console.warn("Mermaid render failed:", err));
            });
        }
        function addLineNumbers() {
          document.querySelectorAll(".reveal pre code").forEach((el) => {
            if (el.hasAttribute("data-line-numbers")) return;
            if (isMermaidBlock(el)) return;
            el.setAttribute("data-line-numbers", "");
            const highlight = Reveal.getPlugin("highlight");
            if (highlight && highlight.highlightBlock)
              highlight.highlightBlock(el);
          });
        }
        addLineNumbers();
        setTimeout(renderMermaidBlocks, 100);
        Reveal.on("ready", () => {
          renderMermaidBlocks();
          setTimeout(renderMermaidBlocks, 400);
          setTimeout(renderMermaidBlocks, 900);
          addLineNumbers();
        });
        Reveal.on("slidechanged", () => {
          renderMermaidBlocks();
          addLineNumbers();
        });
      });
    </script>
  </body>
</html>
